@model MIEL.web.Models.ViewModel.ProductEditVM;
@{
    ViewData["Title"] = "Product Master Edit";
    Layout = "_AdminLayout";
}


<h2>Edit Product</h2>

@if (TempData["msg"] != null)
{
    <div class="alert alert-success">@TempData["msg"]</div>
}
<form method="post" action="/ProductMaster/Update" enctype="multipart/form-data">

<input type="hidden" name="ProductId" value="@Model.Product.ProductId" />

<label>Product Name</label>
<input type="text" name="ProductName"
       value="@Model.Product.ProductName"
       class="form-control" />

<label>Category</label>
    <select name="CategoryId" class="form-control">
        @foreach (var c in Model.Categories)
        {
            <option value="@c.CategoryId"
                    selected="@(c.CategoryId == Model.Product.CategoryId)">
                @c.CategoryName
            </option>
        }
    </select>

<h4>Specifications</h4>
@foreach (var s in Model.Specifications)
{
    <label>@s.Id</label>
    <input type="text"
           name="Specs[@s.Id]"
           value="@s.specificationvalue"
           class="form-control mb-2" />
}

<h4>Variants</h4>
@foreach (var v in Model.Variants)
{
    <input type="text" name="colour[]" value="@v.colour" />
    <input type="text" name="size[]" value="@v.size" />
}
    <div class="card p-3 mb-4">
        <h4 class="mb-3">Product Images</h4>

        @{
            var mainImg = Model.Images.FirstOrDefault(x => x.Flag == 1);
            var otherImgs = Model.Images.Where(x => x.Flag == 0).ToList();
        }

        <!-- MAIN IMAGE -->
        <div class="row mb-4">
            <div class="col-md-4">
                <label class="fw-bold">Main Image</label>

                @if (mainImg != null)
                {
                    <img id="mainPreview"
                         src="@mainImg.ImgPath"
                         class="img-thumbnail d-block mt-2"
                         style="height:150px;width:150px;object-fit:cover;" />

                    <input type="hidden"
                           name="OldMainImageId"
                           value="@mainImg.ImgId" />
                }

                <input type="file"
                       name="Image"
                       class="form-control mt-2"
                       onchange="previewImage(this, 'mainPreview')" />
            </div>
        </div>

        <!-- OTHER IMAGES -->
        <div class="row">
            @for (int i = 0; i < otherImgs.Count; i++)
            {
                <div class="col-md-3 text-center mb-3">
                    <label class="fw-bold">Image @(i + 2)</label>

                    <img id="preview@(i)"
                         src="@otherImgs[i].ImgPath"
                         class="img-thumbnail d-block mx-auto mt-2"
                         style="height:120px;width:120px;object-fit:cover;" />

                    <input type="hidden"
                           name="OldImageIds"
                           value="@otherImgs[i].ImgId" />

                    <input type="file"
                           name="Image@(i + 2)"
                           class="form-control mt-2"
                           onchange="previewImage(this, 'preview@(i)')" />
                </div>
            }
        </div>
    </div>

    <!-- ================= SIZE CHART ================= -->
    @* <div class="card p-3 mb-4">
        <h4>Size Chart</h4>

        @if (!string.IsNullOrEmpty(Model.Product.sizechartPath))
        {
            <p>Current Size Chart:</p>

            @if (Model.Product.sizechartPath.EndsWith(".pdf"))
            {
                <a href="@Model.Product.sizechartPath"
                   target="_blank"
                   class="btn btn-info">
                    View Size Chart (PDF)
                </a>
            }
            else
            {
                <img id="sizeChartPreview"
                     src="@Model.Product.sizechartPath"
                     class="img-thumbnail"
                     style="height:200px;" />
            }
        }

        <input type="file"
               name="SizeChartImg"
               class="form-control mt-2"
               onchange="previewImage(this, 'sizeChartPreview')" />
    </div> *@

    <!-- ================= SIZE CHART ================= -->
    <div class="card p-3 mb-4">
        <h4 class="mb-3">Size Chart</h4>

        <div class="row align-items-center">
            <!-- PREVIEW / LINK -->
            <div class="col-md-4 text-center">
                @if (!string.IsNullOrEmpty(Model.Product.sizechartPath))
                {
                    @if (Model.Product.sizechartPath.EndsWith(".pdf"))
                    {
                        <a href="@Model.Product.sizechartPath"
                           target="_blank"
                           class="btn btn-outline-primary mb-2">
                            View Size Chart (PDF)
                        </a>

                        <img id="sizeChartPreview"
                             class="img-thumbnail d-none mt-2"
                             style="height:200px;" />
                    }
                    else
                    {
                        <img id="sizeChartPreview"
                             src="@Model.Product.sizechartPath"
                             class="img-thumbnail"
                             style="height:200px;object-fit:contain;" />
                    }
                }
                else
                {
                    <img id="sizeChartPreview"
                         class="img-thumbnail d-none"
                         style="height:200px;object-fit:contain;" />
                }
            </div>

            <!-- UPLOAD -->
            <div class="col-md-8">
                <label class="fw-bold">Upload New Size Chart</label>
                <input type="file"
                       name="SizeChartImg"
                       class="form-control"
                       accept=".jpg,.jpeg,.png,.pdf"
                       onchange="previewImage(this, 'sizeChartPreview')" />

                <small class="text-muted d-block mt-2">
                    Accepted formats: JPG, PNG, PDF
                </small>
            </div>
        </div>
    </div>


<button class="btn btn-success mt-3">Update</button>
</form>


<script>
    function previewImage(input, imgId) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById(imgId).src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>

