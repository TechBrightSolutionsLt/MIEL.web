@{
    ViewData["Title"] = "Home";
    Layout = "_Layout";
}
@using MIEL.web.Models.EntityModels
@using System.Linq
@{
    var bannerImages = ViewBag.BannerImages as List<ImageItem>;
}
@using MIEL.web.Models.ViewModel
@{
    var categories = ViewBag.indexcategoryVM as List<indexcategoryVM>;
}
@{
    var mainCategories = ViewBag.MainCategories;
}

<!-- MAIN CATEGORY MENU -->
<div class="container-fluid bg-light border-bottom">
    <div class="row px-xl-5">
        <div class="col-12">
            <ul class="nav justify-content-center py-2" id="mainCategories">
                @if (mainCategories != null)
                {
                    foreach (var item in mainCategories)
                    {
                        <li class="nav-item mx-3 position-relative">
                            <a href="javascript:void(0)"
                               class="nav-link text-dark fw-bold main-cat"
                               data-id="@item.MainCategoryId">
                                @item.MainCategoryName
                            </a>

                            <!-- subcategory placeholder -->
                            <ul class="nav flex-column subcat-container position-absolute bg-white border shadow-sm d-none" style="top:100%; left:0;">
                                <!-- loaded dynamically -->
                            </ul>
                        </li>
                    }
                }
            </ul>


        </div>
    </div>
</div>

<!-- SUBCATEGORY BAR -->
<div class="container-fluid bg-white border-bottom">
    <div class="row px-xl-5">
        <div class="col-12">
            <ul class="nav justify-content-center py-2" id="subCategories">
                <!-- subcategories load here -->
            </ul>
        </div>
    </div>
</div>

<div id="header-carousel" class="carousel slide" data-ride="carousel">
    <div class="carousel-inner">

        @* ===== CASE 1: ADMIN IMAGES EXIST ===== *@
        @if (bannerImages != null && bannerImages.Any())
        {
            bool first = true;

            foreach (var item in bannerImages)
            {
                <div class="carousel-item @(first ? "active" : "")" style="height:500px;">
                    <img class="w-100"
                         src="@item.ImagePath"
                         style="height:500px; object-fit:cover; object-position: top;"
                         alt="Banner Image">
                    <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
                        <div class="p-3" style="max-width:700px;">
                            <h3 class="display-4 text-white font-weight-semi-bold mb-4">
                                Welcome
                            </h3>
                            <a href="#" class="btn btn-light py-2 px-3">Shop Now</a>
                        </div>
                    </div>
                </div>

                first = false;
            }
        }
        else
        {
            @* ===== CASE 2: NO ADMIN IMAGES (DEFAULT FALLBACK) ===== *@
            <div class="carousel-item active" style="height:500px;">
                <img class="img-fluid w-100 h-100"
                     style="object-fit:cover"
                     src="~/img/carousel-1.jpg"
                     alt="Default Banner">
            </div>

            <div class="carousel-item" style="height:500px;">
                <img class="img-fluid w-100 h-100"
                     style="object-fit:cover"
                     src="~/img/carousel-2.jpg"
                     alt="Default Banner">
            </div>
        }

    </div>
    <a class="carousel-control-prev" href="#header-carousel" data-slide="prev">
        <div class="btn btn-dark" style="width: 45px; height: 45px;">
            <span class="carousel-control-prev-icon mb-n2"></span>
        </div>
    </a>
    <a class="carousel-control-next" href="#header-carousel" data-slide="next">
        <div class="btn btn-dark" style="width: 45px; height: 45px;">
            <span class="carousel-control-next-icon mb-n2"></span>
        </div>
    </a>
</div>
<!-- Featured Start -->
<div class="container-fluid pt-5">
    <div class="row px-xl-5 pb-3">
        <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
            <div class="d-flex align-items-center border mb-4 p-4">
                <h1 class="fa fa-check text-primary m-0 mr-3"></h1>
                <h5 class="font-weight-semi-bold m-0">Quality Product</h5>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
            <div class="d-flex align-items-center border mb-4 p-4">
                <h1 class="fa fa-shipping-fast text-primary m-0 mr-3"></h1>
                <h5 class="font-weight-semi-bold m-0">Free Shipping</h5>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
            <div class="d-flex align-items-center border mb-4 p-4">
                <h1 class="fas fa-exchange-alt text-primary m-0 mr-3"></h1>
                <h5 class="font-weight-semi-bold m-0">14-Day Return</h5>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
            <div class="d-flex align-items-center border mb-4 p-4">
                <h1 class="fa fa-phone-volume text-primary m-0 mr-3"></h1>
                <h5 class="font-weight-semi-bold m-0">24/7 Support</h5>
            </div>
        </div>
    </div>
</div>
<!-- Featured End -->



<!-- Categories Start -->
<div class="container-fluid pt-5">
    <div class="row px-xl-5 pb-3">

        @if (categories != null && categories.Any())
        {
            foreach (var item in categories)
            {
                <div class="col-lg-4 col-md-6 pb-4">
                    <div class="cat-item">
                        <a href="@Url.Action("CategoryProducts", "Home",
                                                           new { categoryId = item.CategoryId })"
                   class="cat-img">

                            <img src="@(string.IsNullOrEmpty(item.ImagePath)
                                                         ? Url.Content("~/img/no-image.png")
                                                         : item.ImagePath)"
                         alt="@item.CategoryName" />
                </a>

                        <h3>@item.CategoryName</h3>
                    </div>
                </div>
                }
        }
        else
        {
            <div class="col-12 text-center">
                <p>No categories found</p>
            </div>
        }

    </div>

<!-- Categories End -->


<!-- Offer Start -->
<div class="container-fluid offer pt-5">
    <div class="row px-xl-5">
        <div class="col-md-6 pb-4">
            <div class="position-relative bg-secondary text-center text-md-right text-white mb-2 py-5 px-5">
                <img src="~/img/offer-1.png" alt="">
                <div class="position-relative" style="z-index: 1;">
                    <h5 class="text-uppercase text-primary mb-3">20% off the all order</h5>
                    <h1 class="mb-4 font-weight-semi-bold">Spring Collection</h1>
                    <a href="#" class="btn btn-outline-primary py-md-2 px-md-3">Shop Now</a>
                </div>
            </div>
        </div>
        <div class="col-md-6 pb-4">
            <div class="position-relative bg-secondary text-center text-md-left text-white mb-2 py-5 px-5">
                <img src="~/img/offer-2.png" alt="">
                <div class="position-relative" style="z-index: 1;">
                    <h5 class="text-uppercase text-primary mb-3">20% off the all order</h5>
                    <h1 class="mb-4 font-weight-semi-bold">Winter Collection</h1>
                    <a href="#" class="btn btn-outline-primary py-md-2 px-md-3">Shop Now</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Offer End -->


<!-- Vendor Start -->
<div class="container-fluid py-5">
    <div class="row px-xl-5">
        <div class="col">
            <div class="owl-carousel vendor-carousel">
                @for (int i = 1; i <= 8; i++)
                {
                    <div class="vendor-item border p-4">
                        <img src="@Url.Content($"~/img/vendor-{i}.jpg")" alt="Vendor @i">
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<!-- Vendor End -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const items = document.querySelectorAll("#header-carousel .carousel-item");
        if (items.length > 0) {
            items.forEach(i => i.classList.remove("active"));
            items[0].classList.add("active");
        }
    });
</script>
    <style>
        #header-carousel .carousel-item {
            height: 500px;
        }

        #header-carousel .banner-img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 🔥 fills banner nicely */
            object-position: center;
        }

        /* ===== MAIN CATEGORY BAR ===== */
        #mainCategories {
            background: #f8f5f0;
            border-bottom: 1px solid #e0dcd5;
            font-family: 'Georgia', serif;
        }

            #mainCategories .nav-link {
                color: #8b6f47;
                
                font-weight: 600;
                letter-spacing: 0.5px;
                text-transform: uppercase;
                padding: 10px 18px;
                transition: all 0.3s ease;
            }

                #mainCategories .nav-link:hover {
                     color: #d4a373;
                     /* classic gold-brown */
                }

        /* ===== SUBCATEGORY BAR ===== */
        #subCategories {
            background: #ffffff;
            border-bottom: 1px solid #e5e2dc;
            min-height: 45px;
            font-family: 'Georgia', serif;
        }

            #subCategories .nav-link {
                color: #a0522d;
                
                font-weight: 500;
                padding: 8px 14px;
                transition: all 0.25s ease;
            }

                #subCategories .nav-link:hover {
                    color: #8b6f47;
                    border-bottom: 2px solid #8b6f47;
                }
                .subcat-container {
    min-width: 150px;
    z-index: 1000;
}

.subcat-container .nav-link {
    white-space: nowrap;
    color: #5a534a;
}

.subcat-container .nav-link:hover {
    color: #8b6f47;
    background-color: #f8f5f0;
}


    </style>
    <script>

                  document.addEventListener("DOMContentLoaded", function () {

            document.querySelectorAll(".main-cat").forEach(cat => {

                cat.addEventListener("mouseenter", function () {
                    const categoryId = this.getAttribute("data-id");

                    // find the subcategory container inside this li
                    const subContainer = this.closest("li").querySelector(".subcat-container");

                    fetch('/Home/GetSubCategories?categoryId=' + categoryId)
                        .then(res => res.json())
                        .then(data => {
                            subContainer.innerHTML = "";

                            if (data.length === 0) {
                                subContainer.innerHTML =
                                    '<li class="nav-item text-muted px-2">No subcategories</li>';
                            } else {
                                data.forEach(sub => {
                                    subContainer.innerHTML += `
                                        <li class="nav-item px-2">
                                            <a href="/Home/CategoryProducts?categoryId=${sub.subCategoryId}"
                                               class="nav-link p-1">
                                                ${sub.subCategoryName}
                                            </a>
                                        </li>`;
                                });
                            }

                            // show the container
                            subContainer.classList.remove("d-none");
                        });
                });

                // hide when leaving the category
                cat.closest("li").addEventListener("mouseleave", function () {
                    const subContainer = this.querySelector(".subcat-container");
                    if (subContainer) subContainer.classList.add("d-none");
                });
            });
        });

    </script>


