@model List<MIEL.web.Models.ViewModel.CartItem>

@{
    var totalQty = Model.Sum(x => x.Quantity);
    var totalAmount = Model.Sum(x => x.Price * x.Quantity);
}
<!-- ===== CHECKOUT STEPS ===== -->
<div class="container mt-4">
    <div class="checkout-steps d-flex justify-content-between align-items-center">

        <div class="step active">
            <div class="circle">1</div>
            <div class="label">Cart</div>
        </div>

        <div class="line"></div>

        <div class="step">
            <div class="circle">2</div>
            <div class="label">Review</div>
        </div>

        <div class="line"></div>

        <div class="step">
            <div class="circle">3</div>
            <div class="label">Payment</div>
        </div>

    </div>
</div>

<div class="container py-4">
    <div class="row">

        <!-- ================= LEFT SIDE ================= -->
        <div class="col-md-8">
            <h4 class="mb-3">My Cart (@totalQty item)</h4>

            @if (!Model.Any())
            {
                <div class="alert alert-warning">Your cart is empty</div>
            }
            else
            {
                @foreach (var item in Model)
                {
                    <div class="card mb-3 shadow-sm">
                        <div class="card-body d-flex">

                            <!-- IMAGE -->
                            <img src="@Url.Content(item.Image)"
                                 class="me-3"
                                 style="width:120px;height:150px;object-fit:cover;" />

                            <!-- DETAILS -->
                            <div class="flex-grow-1">

                                <h6 class="fw-bold">@item.ProductName</h6>

                                <p class="text-muted mb-1">
                                    Color: <strong>@item.Color</strong> |
                                    Size: <strong>@item.Size</strong>
                                </p>

                                <p class="mb-1">
                                    Price: <strong>₹@item.Price</strong>
                                </p>

                                <p class="mb-2">
                                    Subtotal:
                                    <strong>
                                        ₹@(item.Price* item.Quantity)
                                    </strong>
                                </p>

                                <!-- QUANTITY -->
                                <div class="d-flex align-items-center mb-2">
                                    <button class="btn btn-outline-secondary btn-sm"
                                            onclick="updateQty(@item.VariantId, -1)">
                                        −
                                    </button>

                                    <span class="px-3 fw-bold">
                                        @item.Quantity
                                    </span>

                                    <button class="btn btn-outline-secondary btn-sm"
                                            onclick="updateQty(@item.VariantId, 1)">
                                        +
                                    </button>
                                </div>

                                <!-- REMOVE BUTTON -->
                                <button class="btn btn-sm btn-danger"
                                        onclick="removeItem(@item.VariantId)">
                                    Remove
                                </button>

                            </div>
                        </div>
                    </div>
                }
            }
        </div>

        <!-- ================= RIGHT SIDE ================= -->
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">

                    <h5>PRICE DETAILS</h5>
                    <hr />

                    <p>
                        Price (@totalQty item)
                        <span class="float-end">
                            ₹@totalAmount
                        </span>
                    </p>

                    <p>
                        Delivery Charges
                        <span class="float-end text-success">
                            FREE
                        </span>
                    </p>

                    <hr />

                    <h6>
                        Total Amount
                        <span class="float-end text-danger">
                            ₹@totalAmount
                        </span>
                    </h6>

                    <button class="btn btn-warning w-100 mt-3 fw-bold"
                            onclick="goToReview()">
                        PLACE ORDER
                    </button>

                </div>
            </div>
        </div>

    </div>
</div>
<style>
    .checkout-steps {
        position: relative;
        margin-bottom: 30px;
    }

    .step {
        text-align: center;
        position: relative;
        z-index: 2;
    }

    .circle {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: #ddd;
        line-height: 35px;
        font-weight: bold;
        margin: auto;
    }

    .label {
        font-size: 14px;
        margin-top: 5px;
    }

    .line {
        flex: 1;
        height: 3px;
        background: #ddd;
        margin: 0 10px;
    }

    /* ACTIVE STEP */
    .step.active .circle {
        background: #f59e0b;
        color: #fff;
    }

    .step.active .label {
        font-weight: bold;
        color: #f59e0b;
    }
</style>

<script>
    function goToReview() {
        window.location.href = '/Home/ReviewOrder';
    }
</script>
<script>
        function updateQty(variantId, change) {

        fetch('/Home/UpdateCartQty', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                variantId: variantId,
                change: change
            })
        })
        .then(res => res.json())
        .then(data => {
            location.reload();
        });
    }

    function removeItem(variantId) {

        if (!confirm("Remove this item?"))
            return;

        fetch('/Home/RemoveCartItem', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                variantId: variantId
            })
        })
        .then(res => res.json())
        .then(data => {
            location.reload();
        });
    }


</script>
