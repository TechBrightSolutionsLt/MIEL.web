@model List<MIEL.web.Models.ViewModel.CartItem>
<div class="container py-4">
    <div class="row">

        <!-- LEFT: CART ITEMS -->
        <div class="col-md-8">
            <h4 class="mb-3">My Cart (@Model.Count item)</h4>

            @if (!Model.Any())
            {
                <div class="alert alert-warning">Your cart is empty</div>
            }
            else
            {
                @foreach (var item in Model)
                {
                    <div class="card mb-3">
                        <div class="card-body d-flex">
                            <img src="@Url.Content(item.Image)"
                                 style="width:120px;height:auto"
                                 class="me-3" />


                            <div class="flex-grow-1">
                                <h6>@item.ProductName</h6>
                                <p class="mb-1">Size: @item.Size</p>
                                <p class="fw-bold">₹@item.Price</p>

                                <div class="d-flex align-items-center">
                                    <button class="btn btn-outline-secondary btn-sm"
                                            onclick="updateQty(@item.ProductId, -1)">
                                        −
                                    </button>

                                    <span class="px-3">@item.Quantity</span>

                                    <button class="btn btn-outline-secondary btn-sm"
                                            onclick="updateQty(@item.ProductId, 1)">
                                        +
                                    </button>

                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>

        <!-- RIGHT: PRICE DETAILS -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5>PRICE DETAILS</h5>
                    <hr />

                    <p>
                        Price (@Model.Sum(x => x.Quantity) item)
                        <span class="float-end">₹@Model.Sum(x => x.Price * x.Quantity)</span>
                    </p>

                    <p>
                        Delivery Charges
                        <span class="float-end text-success">FREE</span>
                    </p>

                    <hr />

                    <h6>
                        Total Amount
                        <span class="float-end">
                            ₹@Model.Sum(x => x.Price * x.Quantity)
                        </span>
                    </h6>

                    <button class="btn btn-warning w-100 mt-3">
                        PLACE ORDER
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>
<script>
    function updateQty(productId, change) {
        fetch('/Home/UpdateCartQty', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                productId: productId,
                change: change
            })
        })
        .then(res => res.json())
        .then(data => {
            location.reload();
        });
    }
</script>
