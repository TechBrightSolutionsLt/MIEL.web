@model MIEL.web.Models.ViewModel.ProductListVM

<div class="container py-5">
    <div class="row align-items-start">

        <!-- THUMBNAILS -->
        <div class="col-lg-1 col-md-2">
            <div class="thumbnail-column">
                <img src="@Model.ImagePath"
                     class="thumb-img active"
                     onmouseover="changeImage(this)" />

                @if (Model.Images != null && Model.Images.Any())
                {
                    foreach (var img in Model.Images)
                    {
                        <img src="@img"
                             class="thumb-img"
                             onmouseover="changeImage(this)" />
                    }
                }
            </div>
        </div>

        <!-- MAIN IMAGE -->
     @*    <div class="col-lg-4 col-md-5">
            <div class="main-image" id="mainImageContainer">
                <img id="mainProductImage"
                     src="@Model.ImagePath"
                     alt="@Model.ProductName" />
                <div id="zoomLens"></div>
            </div>
        </div> *@
        <div class="col-lg-4 col-md-5 position-relative">
            <div class="main-image" id="mainImageContainer">
                <img id="mainProductImage"
                     src="@Model.ImagePath"
                     alt="@Model.ProductName" />
                <div id="zoomLens"></div>
            </div>

            <!-- ZOOM RESULT (floating) -->
            <div id="zoomResult"></div>
        </div>
        <!-- ZOOM RESULT -->
 @*        <div class="col-lg-4 d-none d-lg-block">
            <div id="zoomResult"></div>
        </div> *@

        <!-- PRODUCT DETAILS -->
        <div class="col-lg-3 col-md-5">

            <h2 class="product-title">@Model.ProductName</h2>
            <p class="product-brand">@Model.Brand</p>

            <!-- COLOR -->
            @if (Model.Variants != null && Model.Variants.Any())
            {
                var colors = Model.Variants.Select(v => v.Color).Distinct().ToList();

                <div class="variant-box">
                    <h6>Color</h6>
                    <div class="variant-options">
                        @foreach (var color in colors)
                        {
                            <span class="variant-pill">@color</span>
                        }
                    </div>
                </div>
            }

            <!-- SIZE -->
            @if (Model.Variants != null && Model.Variants.Any())
            {
                var sizes = Model.Variants.Select(v => v.Size).Distinct().ToList();

                <div class="variant-box">
                    <h6>Size</h6>
                    <div class="variant-options">
                        @foreach (var size in sizes)
                        {
                            <span class="variant-pill">@size</span>
                        }
                    </div>
                </div>
            }
            <div id="sizeError" style="color:red; font-size:13px; display:none;">
                Please select a size
            </div>

            <!-- BUTTONS -->
            <div class="btn-row mt-4">
                <button class="btn btn-outline-dark me-3"
                        onclick="addToCart(@Model.ProductId)">
                    Add to Cart
                </button>

                <button class="btn btn-buy">
                    Buy Now
                </button>
            </div>

            <!-- HIGHLIGHTS -->
            @if (Model.Specificationsnew != null && Model.Specificationsnew.Any())
            {
                <div class="highlight-box mt-5">
                    <h5>Product Highlights</h5>

                    @foreach (var spec in Model.Specificationsnew)
                    {
                        <div class="highlight-row">
                            <strong>@spec.SpecName</strong> : @spec.SpecValue
                        </div>
                    }
                </div>
            }

        </div>
    </div>
</div>

<style>
    .thumbnail-column {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .thumb-img {
        width: 70px;
        height: 70px;
        object-fit: cover;
        border: 1px solid #ddd;
        cursor: pointer;
        padding: 3px;
    }

    .thumb-img.active {
        border: 2px solid #000;
    }

    .main-image {
        position: relative;
        width: 100%;
        height: 480px;
        border: 1px solid #eee;
        overflow: hidden;
        background: #fff;
    }

    .main-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    #zoomLens {
        position: absolute;
        border: 1px solid #000;
        width: 180px;
        height: 180px;
        display: none;
        background: rgba(255,255,255,0.4);
        /* cursor: crosshair; */
        pointer-events: none;
    }




    #zoomResult {
        position: absolute;
        top: 0;
        left: 105%; /* pushes zoom to the right of image */
        width: 380px;
        height: 480px;
        border: 1px solid #eee;
        background-repeat: no-repeat;
        background-size: 1200px 1600px;
        display: none;
        background-color: #fff;
        z-index: 10;
    }

    .product-title {
        font-weight: 700;
        font-size: 26px;
    }

    .product-brand {
        color: #888;
        font-size: 13px;
        text-transform: uppercase;
        margin-bottom: 20px;
    }

    .variant-box {
        margin-bottom: 20px;
    }

    .variant-options {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .variant-pill {
        padding: 8px 16px;
        border: 1px solid #ccc;
        border-radius: 25px;
        cursor: pointer;
        font-size: 14px;
        background: #fff;
    }

    .variant-pill.active {
        background: #000;
        color: #fff;
    }

    .btn-buy {
        background: #d32f2f;
        color: #fff;
        border: none;
        padding: 10px 30px;
        border-radius: 6px;
        font-weight: 600;
    }

    .highlight-box {
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 15px;
        background: #fff;
    }

    .highlight-row {
        margin-bottom: 8px;
        font-size: 14px;
    }

  
    @@media (max-width: 992px) {
        #zoomResult

    {
        display: none !important;
    }}
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {

        const img = document.getElementById("mainProductImage");
        const lens = document.getElementById("zoomLens");
        const result = document.getElementById("zoomResult");

        let selectedSize = null;

        // ---------------- ZOOM ----------------
        function initZoom() {
            if (!img || !lens || !result) return;

            result.style.backgroundImage = `url('${img.src}')`;

            const cx = result.offsetWidth / lens.offsetWidth;
            const cy = result.offsetHeight / lens.offsetHeight;

            result.style.backgroundSize =
                (img.width * cx) + "px " +
                (img.height * cy) + "px";
        }

        function moveLens(e) {
        const rect = img.getBoundingClientRect();

        const imgWidth = rect.width;
        const imgHeight = rect.height;

        let x = e.clientX - rect.left - lens.offsetWidth / 2;
        let y = e.clientY - rect.top - lens.offsetHeight / 2;

        if (x < 0) x = 0;
        if (y < 0) y = 0;
        if (x > imgWidth - lens.offsetWidth) x = imgWidth - lens.offsetWidth;
        if (y > imgHeight - lens.offsetHeight) y = imgHeight - lens.offsetHeight;

        lens.style.left = x + "px";
        lens.style.top = y + "px";

        const cx = result.offsetWidth / lens.offsetWidth;
        const cy = result.offsetHeight / lens.offsetHeight;

        result.style.backgroundPosition =
            "-" + (x * cx) + "px -" + (y * cy) + "px";
    }


        if (img) {
        img.addEventListener("mouseenter", () => {
            lens.style.display = "block";
            result.style.display = "block";  // show zoom result
            initZoom();
        });

        img.addEventListener("mousemove", moveLens);
        lens.addEventListener("mousemove", moveLens);

        img.addEventListener("mouseleave", () => {
            lens.style.display = "none";
            result.style.display = "none";  // hide zoom result
        });
    }


        window.changeImage = function (el) {
            document.querySelectorAll(".thumb-img")
                .forEach(img => img.classList.remove("active"));

            el.classList.add("active");
            img.src = el.src;

            setTimeout(initZoom, 100);
        };

        // ---------------- SIZE SELECTION ----------------
        document.querySelectorAll(".variant-pill").forEach(el => {
            el.addEventListener("click", function () {

                this.parentElement.querySelectorAll(".variant-pill")
                    .forEach(p => p.classList.remove("active"));

                this.classList.add("active");

                selectedSize = this.innerText;

                const err = document.getElementById("sizeError");
                if (err) err.style.display = "none";
            });
        });

        // ---------------- ADD TO CART ----------------
        window.addToCart = function (productId) {

            if (!selectedSize) {
                const err = document.getElementById("sizeError");
                if (err) err.style.display = "block";
                return;
            }

            fetch('/Home/AddToCart', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    productId: productId,
                    quantity: 1,
                    size: selectedSize
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    fetch('/Home/GetCartCount')
                        .then(res => res.json())
                        .then(c => {
                            const cartCount = document.getElementById("cartCount");
                            if (cartCount) {
                                cartCount.textContent = c.count;
                            }
                        });
                }
            });
        };

        initZoom();
    });
</script>
